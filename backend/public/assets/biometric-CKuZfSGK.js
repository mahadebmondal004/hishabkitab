const c=async()=>{try{return window.PublicKeyCredential?await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable():!1}catch(e){return console.error("Error checking biometric availability:",e),!1}},l=async(e,t)=>{try{if(!await c())throw new Error("Biometric authentication is not available on this device");const o=new Uint8Array(32);window.crypto.getRandomValues(o);const n={challenge:o,rp:{name:"Hishab Kitab",id:window.location.hostname},user:{id:new TextEncoder().encode(e.toString()),name:t,displayName:t},pubKeyCredParams:[{type:"public-key",alg:-7},{type:"public-key",alg:-257}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required",requireResidentKey:!1},timeout:6e4,attestation:"none"},i=await navigator.credentials.create({publicKey:n});if(!i)throw new Error("Failed to create biometric credential");const a=btoa(String.fromCharCode(...new Uint8Array(i.rawId)));return localStorage.setItem("biometricCredentialId",a),{success:!0,credentialId:a}}catch(r){throw console.error("Biometric registration error:",r),r.name==="NotAllowedError"?new Error("Biometric registration was cancelled or not allowed"):r.name==="NotSupportedError"?new Error("Biometric authentication is not supported on this device"):r.name==="InvalidStateError"?new Error("Biometric credentials already exist for this device"):r}},s=async()=>{try{if(!await c())throw new Error("Biometric authentication is not available on this device");const t=localStorage.getItem("biometricCredentialId");if(!t)throw new Error("No biometric credentials found. Please enable fingerprint login first.");const r=new Uint8Array(32);window.crypto.getRandomValues(r);const o=Uint8Array.from(atob(t),a=>a.charCodeAt(0)),n={challenge:r,allowCredentials:[{id:o,type:"public-key",transports:["internal"]}],userVerification:"required",timeout:6e4},i=await navigator.credentials.get({publicKey:n});if(!i)throw new Error("Biometric authentication failed");return{success:!0,assertion:i}}catch(e){throw console.error("Biometric authentication error:",e),e.name==="NotAllowedError"?new Error("Biometric authentication was cancelled or failed"):e.name==="NotSupportedError"?new Error("Biometric authentication is not supported on this device"):e}},d=()=>{localStorage.removeItem("biometricCredentialId"),localStorage.removeItem("biometricEnabled")};export{s as authenticateBiometric,c as isBiometricAvailable,l as registerBiometric,d as removeBiometric};
